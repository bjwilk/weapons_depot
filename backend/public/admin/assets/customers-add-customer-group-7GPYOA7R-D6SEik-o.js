import{u as z,a as E,b as I}from"./chunk-QIWEFQ5Y-C8tDqCDz.js";import{a4 as B,af as D,a6 as q,R as H,j as e,b as C,r as p,ab as K,ac as M,dI as N,s as O,t as S,q as Q,dS as L,G as V,B as b,W as $}from"./index-Dd5AIRt1.js";import{u as W,D as Z}from"./chunk-XVFA73MY-BMaVn9_N.js";import"./lodash-BSdnRVRc.js";import"./chunk-5AU4DI7M-Ck_cVJRv.js";import"./chunk-E3YGDIJC-DNIXVXp2.js";import{K as J}from"./chunk-CEEYZHMN-DuC6-VW1.js";import{R as d,u as U}from"./chunk-MDIOSTKB-DMuKuBFN.js";import{C as x}from"./checkbox-C6j9JG97.js";import{c as X}from"./index-391Gg0Ss.js";import"./chunk-C76H5USB-DJZABeme.js";import"./chunk-OI7BBNYW-By6QQi9v.js";import"./chunk-P3UUX2T6-BjdsmG3m.js";import"./chunk-YEDAFXMB-D7buONTO.js";import"./chunk-AOFGTNG6-CmvDtUlD.js";import"./chunk-WX2SMNCD-BJTVtiMv.js";import"./plus-mini-BwJJ7XIZ.js";import"./command-bar-D-8Acngt.js";import"./index-C70Cb1KD.js";import"./chunk-QAF7PVQE-UJeTHqTb.js";import"./format-BkG7sM8d.js";import"./date-picker-DpqbO765.js";import"./popover-D6P9NTCz.js";import"./x-mark-mini-BWMGrVIU.js";import"./triangle-left-mini-CZpnYzgZ.js";import"./prompt-DruOcYql.js";var Y=B({customer_group_ids:D(q()).min(1)}),h=10,ee=({customerId:u})=>{const{t:o}=C(),{handleSuccess:g}=U(),[r,l]=p.useState(!1),n=K({defaultValues:{customer_group_ids:[]},resolver:M(Y)}),{setValue:c}=n,[a,j]=p.useState({});p.useEffect(()=>{c("customer_group_ids",Object.keys(a).filter(s=>a[s]),{shouldDirty:!0,shouldTouch:!0})},[a,c]);const{searchParams:_,raw:v}=z({pageSize:h}),P=E(),{customer_groups:m,count:f,isPending:R,isError:T,error:k}=N({fields:"*customers",..._}),w=s=>{const i=typeof s=="function"?s(a):s,t=Object.keys(i);c("customer_group_ids",t,{shouldDirty:!0,shouldTouch:!0}),j(i)},y=te(),{table:G}=W({data:m??[],columns:y,count:f,enablePagination:!0,enableRowSelection:s=>{var i;return!((i=s.original.customers)!=null&&i.map(t=>t.id).includes(u))},getRowId:s=>s.id,pageSize:h,rowSelection:{state:a,updater:w}}),A=n.handleSubmit(async s=>{l(!0);try{const i=s.customer_group_ids.map(t=>O.admin.customerGroup.batchCustomers(t,{add:[u]}));await Promise.all(i),S.success(o("customers.groups.add.success",{groups:s.customer_group_ids.map(t=>m==null?void 0:m.find(F=>F.id===t)).filter(Boolean).map(t=>t==null?void 0:t.name)})),await Q.invalidateQueries({queryKey:L.lists()}),g(`/customers/${u}`)}catch(i){S.error(i.message)}finally{l(!1)}});if(T)throw k;return e.jsx(d.Form,{form:n,children:e.jsxs(J,{className:"flex h-full flex-col overflow-hidden",onSubmit:A,children:[e.jsx(d.Header,{children:e.jsx("div",{className:"flex items-center justify-end gap-x-2",children:n.formState.errors.customer_group_ids&&e.jsx(V,{variant:"error",children:n.formState.errors.customer_group_ids.message})})}),e.jsx(d.Body,{className:"size-full overflow-hidden",children:e.jsx(Z,{table:G,columns:y,pageSize:h,count:f,filters:P,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],isLoading:R,layout:"fill",search:"autofocus",queryObject:v,noRecords:{message:o("customers.groups.add.list.noRecordsMessage")}})}),e.jsxs(d.Footer,{children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(b,{type:"submit",variant:"primary",size:"small",isLoading:r,children:o("actions.save")})]})]})})},se=X(),te=()=>{const{t:u}=C(),o=I();return p.useMemo(()=>[se.display({id:"select",header:({table:r})=>e.jsx(x,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:l=>r.toggleAllPageRowsSelected(!!l)}),cell:({row:r})=>{const l=!r.getCanSelect(),n=r.getIsSelected()||l,c=e.jsx(x,{checked:n,disabled:l,onCheckedChange:a=>r.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}});return l?e.jsx($,{content:u("customers.groups.alreadyAddedTooltip"),side:"right",children:c}):c}}),...o],[u,o])},we=()=>{const{id:u}=H();return e.jsx(d,{children:e.jsx(ee,{customerId:u})})};export{we as Component};
